!function(t){function e(){this.init()}e.prototype={init:function(){this.initEvent(),this.getData()},getData:function(){var t=this;Pub.post("/Home/order/index",{},function(e){0==e.error_code&&(t.orderList(e.data.list),t.initEv())})},orderList:function(e){t("#order_list").empty();var o="";if(e&&e.length>0){for(var r in e){o+='<div class="order-item"><div class="order-status"><a href="'+Pub.getHtmlUrl("html/user/user-order-cont.2f5cebff.html")+"?id="+e[r].id+'"><span>'+e[r].order_sn+"</span>",100==e[r].order_status?o+="<strong>待付款</strong>":200==e[r].order_status?o+="<strong>待发货</strong>":101==e[r].order_status?o+="<strong>已取消</strong>":210==e[r].order_status?o+="<strong>待收货</strong>":220==e[r].order_status?o+="<strong>待评价</strong>":222==e[r].order_status?o+="<strong>交易完成</strong>":300==e[r].order_status?o+="<strong>退款中</strong>":310==e[r].order_status&&(o+="<strong>退款成功</strong>"),o+='</a></div><div class="complete-goods"><a href="'+Pub.getHtmlUrl("html/user/user-order-cont.2f5cebff.html")+"?id="+e[r].id+'"><ul>';for(var n in e[r].goods){o+='<li><div class="img"><span></span><img src="'+e[r].goods[n].goods_img+'"></div><div class="info"><div class="name"><h4>'+e[r].goods[n].goods_name+'</h4></div><div class="sizes">';var d=e[r].goods[n].spec_key_name.split(" ");for(var i in d)o+="<h4>"+d[i]+"</h4>";o+='</div><div class="price"><h4>￥ '+e[r].goods[n].goods_price+"</h4><h3>X "+e[r].goods[n].goods_num+"</h3></div></div></li>"}o+='</ul></a><div class="complete-total"><h3 style="text-align: right;">实付款： <span>￥ '+e[r].order_amount+'</span></h3></div><div class="handle">',100==e[r].order_status?o+='<button class="order-cancel" data-index="'+e[r].id+'">取消订单</button><button class="order-pay" data-index="'+e[r].id+'">立即支付</button><button class="order-delect" data-index="'+e[r].id+'" style="display:none;">删除订单</button>':200==e[r].order_status?o+='<button class="order-refund" data-index="'+e[r].id+'">申请退款</button>':101==e[r].order_status?o+='<button class="order-delect" data-index="'+e[r].id+'">删除订单</button>':210==e[r].order_status?o+='<button class="order-return" data-index="'+e[r].id+'">申请退货</button><button class="order-confirm" data-index="'+e[r].id+'">确认收货</button>':220==e[r].order_status&&(o+='<button class="order-return" data-index="'+e[r].id+'">申请退货</button><button class="order-comment" data-index="'+e[r].id+'">去评价</button>'),o+="</div></div></div>"}t("#order_list").append(o)}else t("#order_list").append('<div class="nothing">暂无订单！</div>')},initEvent:function(){t("#order_menu").on("click",function(){t("#order_menu_show").show(),t("#order_menu_black").show()}),t("#order_menu_black").on("click",function(){t("#order_menu_show").hide(),t("#order_menu_black").hide()})},initEv:function(){var e=this;t(".order-pay").on("click",function(){var o=t(this).attr("data-index");Pub.post("/Home/Pay/toPay",{order_id:o},function(t){console.log(t),0==t.error_code?(cloud.msg("正在跳转支付！","50%",2e3),e.payCall(t.data.jsApiParameters)):cloud.msg(t.message,"50%",2e3)})}),t(".order-delect").on("click",function(){var e=t(this).attr("data-index"),o=this;cloud.asked("您确定要删除吗？",function(){Pub.post("/Home/order/delete",{id:e},function(e){0===e.error_code&&(setTimeout(t(o).parent().parent().parent().fadeOut(),2e3),cloud.explain("恭喜您，删除成功！","success",2e3))})},function(){cloud.msg("您选择了取消","50%",2e3)})}),t(".order-cancel").on("click",function(){var e=t(this).attr("data-index"),o=this;cloud.asked("您确定要取消订单吗",function(){Pub.post("/Home/order/cancel",{id:e},function(e){0===e.error_code&&(cloud.explain("订单已取消！","success",2e3),t(o).hide(),t(o).siblings().hide(),t(o).siblings(".order-delect").show(),t(o).removeClass("order-cancel"),t(o).addClass("order-delect"),t(o).parent().parent().siblings().children("strong").text("已取消"))})},function(){cloud.msg("您选择了取消","50%",2e3)})}),t(".order-refund").on("click",function(){var e=t(this).attr("data-index"),o=Pub.getHtmlUrl("html/user/user-refund.9c9a121a.html")+"?id="+e;location.href=o}),t(".order-return").on("click",function(){var e=t(this).attr("data-index"),o=Pub.getHtmlUrl("html/user/user-return.e5da019e.html")+"?id="+e;location.href=o}),t(".order-confirm").on("click",function(){var e=t(this).attr("data-index"),o=this;cloud.asked("您确定收货吗？",function(){Pub.post("/Home/order/delivery",{id:e},function(e){console.log(e),0==e.error_code&&(cloud.explain("您已成功收货！","success",2e3),t(o).text("去评价"),t(o).removeClass("order-confirm"),t(o).addClass("order-comment")),t(".order-comment").on("click",function(e){e&&e.stopPropagation?e.stopPropagation():window.event.cancelBubble=!0;var o=t(this).attr("data-index"),r=Pub.getHtmlUrl("html/user/user-judge.4adde8c4.html")+"?id="+o;location.href=r})})},function(){cloud.msg("您选择了取消","50%",2e3)})}),t(".order-comment").on("click",function(e){e&&e.stopPropagation?e.stopPropagation():window.event.cancelBubble=!0;var o=t(this).attr("data-index"),r=Pub.getHtmlUrl("html/user/user-judge.4adde8c4.html")+"?id="+o;location.href=r})},apiCall:function(t){var e=jQuery.parseJSON(t);WeixinJSBridge.invoke("getBrandWCPayRequest",e,function(t){"get_brand_wcpay_request:ok"==t.err_msg?(cloud.explain("支付成功！！！","success",2e3),location.href=Pub.getHtmlUrl("html/user/user-order.ac9cef1c.html")):(cloud.explain("支付失败！！！",2e3),location.href=Pub.getHtmlUrl("html/user/user-order-daiFuKuan.9bd09458.html"))})},payCall:function(t){var e=this;"undefined"==typeof WeixinJSBridge?document.addEventListener?document.addEventListener("WeixinJSBridgeReady",e.apiCall(t),!1):document.attachEvent&&(document.attachEvent("WeixinJSBridgeReady",e.apiCall(t)),document.attachEvent("onWeixinJSBridgeReady",e.apiCall(t))):e.apiCall(t)}};new e}(jQuery);