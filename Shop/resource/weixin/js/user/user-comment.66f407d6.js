!function(o,s,e){function i(){this.init()}i.prototype={params:{order_id:0,goods_id:0,goods_img:"",goods_name:"",content:"",comment_img:"",goods_index:0,speed_index:0,server_index:0,poss_port:"",temp:"",imgs_file:[]},init:function(){this.initParams(),this.getData(),this.upLoadImg(),this.initEvent()},initParams:function(){var o=Pub.searchToObject();this.params.order_id=o.id,this.params.goods_id=o.gid,this.params.goods_img=o.img,this.params.goods_name=decodeURI(o.name),this.params.poss_port=Pub.getSession("_passport")},getData:function(){o("#goods_info").empty();var s='<div class="img"><a href="../goods/cont.html?id='+this.params.goods_id+'"><span></span><img src="'+this.params.goods_img+'"></a></div><div class="name"><div class="name-center"><a href="../goods/cont.html?id='+this.params.goods_id+'"><h3>'+this.params.goods_name+"</h3></a></div></div>";o("#goods_info").append(s)},initEvent:function(){var s=this;o("#order_menu").on("click",function(){o("#order_menu_show").show(),o("#order_menu_black").show()}),o("#order_menu_black").on("click",function(){o("#order_menu_show").hide(),o("#order_menu_black").hide()}),o("#star_goods i").on("click",function(){var e=o(this).index();o("#star_goods i:lt("+(e+1)+")").addClass("active"),o("#star_goods i:gt("+e+")").removeClass("active"),s.params.goods_index=e}),o("#star_delivery i").on("click",function(){var e=o(this).index();o("#star_delivery i:lt("+(e+1)+")").addClass("active"),o("#star_delivery i:gt("+e+")").removeClass("active"),s.params.speed_index=e}),o("#star_service i").on("click",function(){var e=o(this).index();o("#star_service i:lt("+(e+1)+")").addClass("active"),o("#star_service i:gt("+e+")").removeClass("active"),s.params.server_index=e}),o("#text_area").on("change",function(){var e=o(this).val();s.params.content=e}),o("#submit_comment").on("click",function(){s.postData()})},postData:function(){""!==this.params.content&&this.params.goods_index&&this.params.speed_index&&this.params.server_index?Pub.post("/Home/Comments/add",{goods_id:this.params.goods_id,order_id:this.params.order_id,content:this.params.content,comment_img:this.params.imgs_file,lv_goods:this.params.goods_index+1,lv_speed:this.params.speed_index+1,lv_server:this.params.server_index+1},function(o){0==o.error_code?(console.log(o),cloud.msg("评价成功！","50%",2e3)):90002==o.error_code&&cloud.msg("您已评价过啦，不能再评了哦！","50%",2e3)}):cloud.msg("请填写完整再提交！","50%",2e3)},upLoadImg:function(){var s=this;o("#upload").Huploadify({auto:!0,fileTypeExts:"*.jpg;*.png;*.exe;*.jpeg;*.gif",multi:!0,formData:{key:123456,_passport:s.params.poss_port},fileSizeLimit:9999,fileObjName:"comment_img_file",buttonText:"",itemTemplate:s.params.temp,showUploadedPercent:!0,showUploadedSize:!0,removeTimeout:9999999,uploader:"http://gwshop.usrboot.com/Home/Comments/uploadCommentImg",onUploadStart:function(){},onInit:function(){},onUploadSuccess:function(e,i,a){i=jQuery.parseJSON(i),console.log(i);var t="";t+='<li><img src="http://gwshop.usrboot.com/'+i.data.imgUrl+'"></li>',o("#upload li.add-img").before(t),s.params.imgs_file.push(i.data.imgUrl[0]),console.log(s.params.imgs_file)},onUploadComplete:function(){},onDelete:function(o){console.log("删除的文件："+o),console.log(o)}})}},new i}(jQuery,window,document);