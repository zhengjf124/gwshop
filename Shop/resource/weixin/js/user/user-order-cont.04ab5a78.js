!function(e){function t(){this.init()}t.prototype={init:function(){this.getData()},getData:function(){var e=this,t=Pub.searchToObject();Pub.post("/Home/order/detail",{id:t.id},function(t){0==t.error_code&&(console.log(t.data),e.orderStatus(t.data.order_status),e.orderLogistics(t.data.logistics_tracking),e.toOrderLogistics(t.data),e.orderAddress(t.data.user_address),e.orderInvoice(t.data),e.orderGoods(t.data.goods),e.orderHandle(t.data),e.orderLike(t.data.goods_like),e.orderCount(t.data),e.orderTotal(t.data),e.orderTime(t.data),e.initEv())})},orderStatus:function(t){e("#order_status").empty();var o="";o+='<div class="font"><div class="font-center">',100==t?o+="待付款":200==t?o+="待发货":101==t?o+="已取消":210==t?o+="待收货":220==t?o+="待评价":222==t?o+="交易完成":300==t?o+="退款中":310==t&&(o+="退款成功"),o+='</div></div><div class="img"><span></span><img src="../../images//img-pay.png"></div>',e("#order_status").append(o)},orderLogistics:function(t){if(e("#order_logistics").empty(),t.length>0){var o="";o+="<h4>"+t[0].context+"</h4><h5>"+t[0].ftime+"</h5>",e("#order_logistics").append(o)}else e("#order_logistics").append("<h5>暂无物流信息！</h5>")},toOrderLogistics:function(t){var o=Pub.getHtmlUrl("html/user/user-order-cont-logistics.f12c1b42.html")+"?id="+t.id;e("#to_order_logistics").on("click",function(){location.href=o})},orderAddress:function(t){e("#order_address").empty();var o=t.mobile,d=o.substr(3,4),r=o.replace(d,"****"),i="";i+="<em>&#xe6e2;</em><h4>收件人："+t.consignee+"&nbsp;&nbsp;"+r+"</h4><p>收货地址："+t.province+t.city+t.district+t.address+"</p>",e("#order_address").append(i)},orderInvoice:function(t){e("#order_invoice").empty();var o="";o+="<h4>发票信息</h4><h4>发票抬头 ："+t.inv_payee+" </h4>",e("#order_invoice").append(o)},orderGoods:function(t){e("#order_goods").empty();var o="";if(t){for(var d in t){o+='<li><div class="img"><a href="'+Pub.getHtmlUrl("html/goods/cont.fb80c266.html")+"?id="+t[d].goods_id+'"><span></span><img src="'+t[d].goods_img+'"></a></div><div class="info"><div class="name"><a href="'+Pub.getHtmlUrl("html/goods/cont.fb80c266.html")+"?id="+t[d].goods_id+'"><h4>'+t[d].goods_name+'</a></div><div class="sizes">';var r=t[d].spec_key_name,i=r.split(" ");for(var n in i)o+="<h4>"+i[n]+"</h4>";o+='</div><div class="price"><h4>￥ '+t[d].goods_price+"</h4><h3>X "+t[d].goods_num+"</h3></div></div></li>"}e("#order_goods").append(o)}},orderHandle:function(t){e("#order_handle").empty();var o="";100==t.order_status?o+='<button class="order-cancel" data-index="'+t.id+'">取消订单</button><button class="order-pay" data-index="'+t.id+'">立即支付</button>':200==t.order_status?o+='<button class="order-refund" data-index="'+t.id+'">申请退款</button>':101==t.order_status?o+='<button class="order-delect" data-index="'+t.id+'">删除订单</button>':210==t.order_status?o+='<button class="order-return" data-index="'+t.id+'">申请退货</button><button class="order-confirm" data-index="'+t.id+'">确认收货</button>':220==t.order_status&&(o+='<button class="order-return" data-index="'+t.id+'">申请退货</button><button class="order-comment" data-index="'+t.id+'">去评价</button>'),e("#order_handle").append(o)},orderCount:function(t){e("#order_count").empty();var o="";o+="<dl><dt>商品金额：</dt><dd>￥"+t.goods_amount+"</dd></dl><dl><dt>运费：</dt><dd>+￥"+t.shipping_fee+"</dd></dl><dl><dt>优惠劵：</dt><dd>-￥"+t.coupon_price+"</dd></dl><dl><dt>积分抵现：</dt><dd>-￥"+t.credit_money+"</dd></dl>",e("#order_count").append(o)},orderTotal:function(t){e("#order_total").empty();var o="";o+="<h3>实付款 <span>￥"+t.order_amount+"</span></h3>",e("#order_total").append(o)},orderTime:function(t){e("#order_time").empty();var o="";o+="<h5>订单编号：  "+t.order_sn+"</h5><h5>下单时间：  "+t.add_time+"</h5>",e("#order_time").append(o)},orderLike:function(t){e("#goods_like").empty();var o="";if(t.length>0){o+='<div class="hot-sale-title"><i>&#xe634;</i><strong>猜你喜欢</strong></div><div class="list-sm"><ul>';for(var d in t)o+='<li><a href="'+Pub.getHtmlUrl("html/goods/cont.fb80c266.html")+"?id="+t[d].id+'"><div class="img"><span></span><img src="'+t[d].original_img+'"></div><div class="info"><div class="name"><h4>'+t[d].goods_name+'</h4></div><div class="price"><h4>￥'+t[d].goods_price+"</h4></div></div></a></li>";o+="</ul></div>",e("#goods_like").append(o)}},initEv:function(){var t=this;e(".order-pay").on("click",function(){var o=e(this).attr("data-index");Pub.post("/Home/Pay/toPay",{order_id:o},function(e){console.log(e),0==e.error_code?(cloud.msg("正在跳转支付！","50%",2e3),t.payCall(e.data.jsApiParameters)):cloud.msg(e.message,"50%",2e3)})}),e(".order-delect").on("click",function(){var t=e(this).attr("data-index"),o=this;cloud.asked("您确定要删除吗？",function(){Pub.post("/Home/order/delete",{id:t},function(t){0==t.error_code&&(cloud.explain("恭喜您，删除成功！","success"),setTimeout(e(o).parent().parent().parent().fadeOut(),2e3))})},function(){cloud.msg("您选择了取消","50%",2e3)})}),e(".order-cancel").on("click",function(){var t=e(this).attr("data-index"),o=this;cloud.asked("您确定要取消订单吗",function(){Pub.post("/Home/order/cancel",{id:t},function(t){0==t.error_code&&(cloud.explain("订单已取消！","success",1e3),e(o).text("删除订单"),e(o).siblings().fadeOut(),e(o).removeClass("order-cancel"),e(o).addClass("order-delect"),e(o).parent().parent().siblings().children("strong").text("已取消"),e(".order-delect").on("click",function(t){t&&t.stopPropagation?t.stopPropagation():window.event.cancelBubble=!0;var o=e(this).attr("data-index"),d=this;Pub.post("/Home/order/delete",{id:o},function(t){0==t.error_code&&(cloud.explain("恭喜您，删除成功！","success",2e3),setTimeout(e(d).parent().parent().parent().fadeOut(),2e3))})}))})},function(){cloud.msg("您选择了取消","50%",2e3)})}),e(".order-refund").on("click",function(){var t=e(this).attr("data-index"),o=Pub.getHtmlUrl("html/user/user-refund.9c9a121a.html")+"?id="+t;location.href=o}),e(".order-return").on("click",function(){var t=e(this).attr("data-index"),o=Pub.getHtmlUrl("html/user/user-return.e5da019e.html")+"?id="+t;location.href=o}),e(".order-confirm").on("click",function(){var t=e(this).attr("data-index"),o=this;cloud.asked("您确定收货吗？",function(){Pub.post("/Home/order/delivery",{id:t},function(t){console.log(t),0==t.error_code&&(cloud.explain("您已成功收货！","success",2e3),e(o).text("去评价"),e(o).removeClass("order-confirm"),e(o).addClass("order-comment")),e(".order-comment").on("click",function(t){t&&t.stopPropagation?t.stopPropagation():window.event.cancelBubble=!0;var o=e(this).attr("data-index"),d=Pub.getHtmlUrl("html/user/user-judge.4adde8c4.html")+"?id="+o;location.href=d})})},function(){cloud.msg("您选择了取消","50%",2e3)})}),e(".order-comment").on("click",function(t){t&&t.stopPropagation?t.stopPropagation():window.event.cancelBubble=!0;var o=e(this).attr("data-index"),d=Pub.getHtmlUrl("html/user/user-judge.4adde8c4.html")+"?id="+o;location.href=d})},apiCall:function(e){var t=jQuery.parseJSON(e);WeixinJSBridge.invoke("getBrandWCPayRequest",t,function(e){"get_brand_wcpay_request:ok"==e.err_msg?cloud.explain("支付成功！！！","success",2e3):cloud.explain("支付失败！！！",2e3)})},payCall:function(e){var t=this;"undefined"==typeof WeixinJSBridge?document.addEventListener?document.addEventListener("WeixinJSBridgeReady",t.apiCall(e),!1):document.attachEvent&&(document.attachEvent("WeixinJSBridgeReady",t.apiCall(e)),document.attachEvent("onWeixinJSBridgeReady",t.apiCall(e))):t.apiCall(e)}},new t}(jQuery);