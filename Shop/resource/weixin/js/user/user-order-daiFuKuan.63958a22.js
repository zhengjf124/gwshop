!function(e){function t(){this.init()}t.prototype={init:function(){this.initEvent(),this.getData()},getData:function(){var e=this;Pub.post("/Home/order/index",{},function(t){0==t.error_code&&(e.orderList(t.data.list),e.initEv())})},orderList:function(t){e("#order_list").empty();var i="";if(t&&t.length>0){for(var o in t)if(100==t[o].order_status){i+='<div class="order-item"><div class="order-status"><a href="'+Pub.getHtmlUrl("html/user/user-order-cont.2f5cebff.html")+"?id="+t[o].id+'"><span>'+t[o].order_sn+'</span><strong>待付款</strong></a></div><div class="complete-goods"><a href="'+Pub.getHtmlUrl("html/user/user-order-cont.2f5cebff.html")+"?id="+t[o].id+'"><ul>';for(var n in t[o].goods){i+='<li><div class="img"><span></span><img src="'+t[o].goods[n].goods_img+'"></div><div class="info"><div class="name"><h4>'+t[o].goods[n].goods_name+'</h4></div><div class="sizes">';var a=t[o].goods[n].spec_key_name.split(" ");for(var r in a)i+="<h4>"+a[r]+"</h4>";i+='</div><div class="price"><h4>￥ '+t[o].goods[n].goods_price+"</h4><h3>X "+t[o].goods[n].goods_num+"</h3></div></div></li>"}i+='</ul></a><div class="complete-total"><h3 style="text-align: right;">实付款： <span>￥ '+t[o].order_amount+'</span></h3></div><div class="handle"><button class="order-cancel" data-index="'+t[o].id+'">取消订单</button><button class="order-pay" data-index="'+t[o].id+'">立即支付</button></div></div></div>'}e("#order_list").append(i)}},initEvent:function(){e("#order_menu").on("click",function(){e("#order_menu_show").show(),e("#order_menu_black").show()}),e("#order_menu_black").on("click",function(){e("#order_menu_show").hide(),e("#order_menu_black").hide()})},initEv:function(){var t=this;e(".order-pay").on("click",function(){var i=e(this).attr("data-index");Pub.post("/Home/Pay/toPay",{order_id:i},function(e){console.log(e),0==e.error_code?t.payCall(e.data.jsApiParameters):cloud.msg(e.message,"50%",2e3)})}),e(".order-cancel").on("click",function(){var t=e(this).attr("data-index"),i=this;cloud.asked("您确定要取消订单吗",function(){Pub.post("/Home/order/cancel",{id:t},function(t){0===t.error_code&&(cloud.explain("订单已取消！","success",2e3),e(i).parent().parent().parent().fadeOut())})},function(){cloud.msg("您选择了取消","50%",2e3)})})},apiCall:function(e){var t=jQuery.parseJSON(e);WeixinJSBridge.invoke("getBrandWCPayRequest",t,function(e){"get_brand_wcpay_request:ok"==e.err_msg?(cloud.explain("支付成功！！！","success",3e3),setTimeout(function(){location.href=Pub.getHtmlUrl("html/user/user-order.ac9cef1c.html")},3e3)):(cloud.explain("支付失败！！！",2e3),setTimeout(function(){location.reload()},3e3))})},payCall:function(e){var t=this;"undefined"==typeof WeixinJSBridge?document.addEventListener?document.addEventListener("WeixinJSBridgeReady",t.apiCall(e),!1):document.attachEvent&&(document.attachEvent("WeixinJSBridgeReady",t.apiCall(e)),document.attachEvent("onWeixinJSBridgeReady",t.apiCall(e))):t.apiCall(e)}},new t}(jQuery);