!function(a,s,e,t){var i=function(){this.init()};i.prototype={params:{offset:0,limit:0,orderStatus:0,loadTemp:"",orderTemp:""},init:function(){this.initParams(),this.getDataInit(),this.initEvent()},initParams:function(){this.params.offset=0,this.params.limit=4,this.params.orderStatus=0,this.params.loadTemp='<div class="loader"><div class="loader-inner ball-spin-fade-loader"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div>',this.params.orderTemp='<div class="order-list"><div class="order-list-top"><strong class="name1">商品名称</strong><strong class="name2">数量</strong><strong class="name3">金额</strong><strong class="name4">下单时间</strong><strong class="name5">交易状态</strong><strong class="name6">交易操作</strong></div><div class="order-list-bottom"><ul id="order_list">'+this.params.loadTemp+'</ul><div class="allpage" id="allpage"></div></div></div>'},getDataInit:function(){var a=this;Pub.post("/Home/order/index",{offset:a.params.offset,limit:a.params.limit,order_status:a.params.orderStatus},function(s){if(console.log(s),0===parseInt(s.error_code)){var e=s.data.list;a.orderList(e),a.params.pages=Math.ceil(s.data.count/a.params.limit),setTimeout(function(){a.dataEvent(),a.pages(a.params.pages),a.pagesEvent(a.params.pages)},600)}})},getData:function(){var s=this;a("#order_list").html(s.params.loadTemp),Pub.post("/Home/order/index",{offset:s.params.offset,limit:s.params.limit,order_status:s.params.orderStatus},function(a){if(0===parseInt(a.error_code)){console.log(a);var e=a.data.list;s.orderList(e),setTimeout(function(){s.dataEvent()},600)}})},orderList:function(s){if(s&&s.length>0){var e="";for(var t in s)if(s.hasOwnProperty(t)){e+='<li><div class="order-number">订单号：'+s[t].order_sn+'</div><div class="item"><div class="item-goods">';for(var i in s[t].goods)s[t].goods.hasOwnProperty(i)&&(e+='<div class="item1"><div class="img"><a href="'+Pub.getHtmlUrl("html/goods/cont-4ec8c688d1.html")+"?id="+s[t].goods[i].goods_id+'"><img src="'+s[t].goods[i].goods_img+'" class="img-scale"></a></div><div class="info"><div class="name"><a href="'+Pub.getHtmlUrl("html/goods/cont-4ec8c688d1.html")+"?id="+s[t].goods[i].goods_id+'" title="'+s[t].goods[i].goods_name+'">'+s[t].goods[i].goods_name+'</a></div><div class="brief">来自英国设计师richard c. evans的创意产品，但只要按照凹槽的纹路你就能...</div></div></div><div class="item2">'+s[t].goods[i].goods_num+'</div><div class="item3">￥'+s[t].goods[i].goods_price+"</div>");switch(e+='</div><div class="item4">'+s[t].add_time+"</div>",s[t].order_status){case"100":e+='<div class="item5"><a class="status">待付款</a>';break;case"200":e+='<div class="item5"><a class="status">待发货</a>';break;case"101":e+='<div class="item5"><a class="status">已取消</a>';break;case"210":e+='<div class="item5"><a class="status">待收货</a>';break;case"220":e+='<div class="item5"><a class="status">待评价</a>';break;case"222":e+='<div class="item5"><a class="status">交易成功</a>';break;case"300":e+='<div class="item5"><a class="status">退款中</a>';break;case"310":e+='<div class="item5"><a class="status">退款成功</a>'}switch(e+='<a class="to-cont" data-id="'+s[t].id+'">订单详情</a></div><div class="item6"><a class="buy-again">再次购买</a>',s[t].order_status){case"100":e+='<a class="order-cancel" data-id="'+s[t].id+'">取消订单</a><a class="order-pay" data-id="'+s[t].id+'">立即支付</a><a class="order-delect" data-id="'+s[t].id+'" style="display:none;">删除订单</a>';break;case"200":e+='<a class="order-refund" data-id="'+s[t].id+'">申请退款</a>';break;case"101":e+='<a class="order-delect" data-id="'+s[t].id+'">删除订单</a>';break;case"210":e+='<a class="order-return" data-id="'+s[t].id+'">申请退货</a><a class="order-return" data-id="'+s[t].id+'">确认收货</a>';break;case"220":e+=""}e+="</div></div></li>"}setTimeout(function(){a("#order_list").html(e)},500)}else a("#order_list").html('<div class="nothing">暂无数据！</div>')},dataEvent:function(){var s=this;a(".order-pay").on("click",function(){var e=a(this).attr("data-index");Pub.post("/Home/Pay/toPay",{order_id:e},function(a){console.log(a),0==a.error_code?(cloud.msg("正在跳转支付！","50%",2e3),s.payCall(a.data.jsApiParameters)):cloud.msg(a.message,"50%",2e3)})}),a(".order-delect").on("click",function(){var s=a(this).attr("data-id"),e=this;cloud.asked("您确定要删除吗？",function(){Pub.post("/Home/order/delete",{id:s},function(s){0===parseInt(s.error_code)&&(setTimeout(a(e).parent().parent().parent().fadeOut(),2e3),cloud.explain("恭喜您，删除成功！","success",2e3))})},function(){cloud.msg("您选择了取消","50%",2e3)})}),a(".order-cancel").on("click",function(){var e=a(this).attr("data-id"),t=this;cloud.asked("您确定要取消订单吗",function(){Pub.post("/Home/order/cancel",{id:e},function(e){0===e.error_code&&(cloud.explain("订单已取消！","success",2e3),a(t).siblings(".order-delect").show(),a(t).parent().siblings().find(".status").text("已取消"),a(t).remove(),s.getDataInit())})},function(){cloud.msg("您选择了取消","50%",2e3)})}),a(".order-refund").on("click",function(){var s=a(this).attr("data-index"),e=Pub.getHtmlUrl("html/user/user-refund.html")+"?id="+s;location.href=e}),a(".order-return").on("click",function(){var s=a(this).attr("data-index"),e=Pub.getHtmlUrl("html/user/user-return.html")+"?id="+s;location.href=e}),a(".order-confirm").on("click",function(){var e=a(this).attr("data-index"),t=this;cloud.asked("您确定收货吗？",function(){Pub.post("/Home/order/delivery",{id:e},function(e){console.log(e),0==e.error_code&&(cloud.explain("您已成功收货！","success",2e3),a(t).text("去评价"),a(t).removeClass("order-confirm"),a(t).addClass("order-comment"),s.getDataInit())})},function(){cloud.msg("您选择了取消","50%",2e3)})}),a(".to-cont").on("click",function(){var e=a(this).attr("data-id");a("#order").html(s.params.loadTemp),s.orderContData(e)})},pages:function(s){var e="";if(s>0){a("#allpage").empty(),e+='<a class="prev" id="prev">上一页</a><span class="pages" id="pages"><span class="page">';for(var t=1;t<=s;t++)e+="<a>"+t+"</a>";e+='</span></span><a class="next" id="next">下一页</a>',a("#allpage").append(e)}},pagesEvent:function(s){var e=this;a("#pages a:nth-child(1)").addClass("active"),e.checkDis();for(var t=1;t<=e.params.pages;t++)a("#pages a").on("click",function(){a(this).is(".active")||(a(this).siblings().removeClass("active"),a(this).addClass("active"),e.params.offset=(a(this).text()-1)*e.params.limit,e.getData()),e.checkDis(),e.goPage(s),a("#page_now").text(a(".page").find(".active").text())});a("#prev").on("click",function(){e.params.offset=e.params.offset-e.params.limit,e.getData(),a("#pages").find(".active").removeClass("active").prev().addClass("active"),e.checkDis(),e.goPage(s),a("#page_now").text(a(".page").find(".active").text())}),a("#next").on("click",function(){e.params.offset=e.params.offset+e.params.limit,e.getData(),a("#pages").find(".active").removeClass("active").next().addClass("active"),e.checkDis(),e.goPage(s),a("#page_now").text(a(".page").find(".active").text())}),a("#page_up").on("click",function(){e.params.offset=e.params.offset-e.params.limit,e.getData(),a("#pages").find(".active").removeClass("active").prev().addClass("active"),e.checkDis(),e.goPage(s),a("#page_now").text(a(".page").find(".active").text())}),a("#page_down").on("click",function(){console.log(e.params.offset),e.params.offset=e.params.offset+e.params.limit,a("#pages").find(".active").removeClass("active").next().addClass("active"),console.log(a(".page").find(".active").text()),e.getData(),e.checkDis(),e.goPage(s),a("#page_now").text(a(".page").find(".active").text())})},goPage:function(s){var e=a(".page a").width()+12,t=e*a(".page a").length,i=e*(a(".page a").length-3),o=46*a(".page").find(".active").text();s<=5?a(".page").css("width",t).animate({left:"0px"},50):o<=138?a(".page").css("width",t).animate({left:"0px"},50):o>138&&o<=i?a(".page").css("width",t).animate({left:-(o-138)+"px"},50):a(".page").css("width",t).animate({left:"-184px"},50)},checkDis:function(){var s=this;0===s.params.offset?a(".prev").addClass("disabled"):a(".prev").removeClass("disabled"),s.params.offset==s.params.limit*(s.params.pages-1)?a(".next").addClass("disabled"):a(".next").removeClass("disabled")},orderContData:function(a){var s=this;Pub.post("/Home/order/detail",{id:a},function(a){if(console.log(a),0===parseInt(a.error_code)){var e=a.data;s.orderCont(e)}})},orderCont:function(s){var e='<div class="order-list"><div class="order-list-top"><strong class="name1">订单详情</strong></div><div class="order-list-bottom"><ul><li><div class="order-number">订单号：'+s.order_sn+'</div><div class="item"><div class="item-goods">';if(s.goods.length>0)for(var t in s.goods)s.goods.hasOwnProperty(t)&&(e+='<div class="item1"><div class="img"><a href="'+Pub.getHtmlUrl("html/goods/cont-4ec8c688d1.html")+"?id="+s.goods[t].goods_id+'"><img src="'+s.goods[t].goods_img+'" class="img-scale"></a></div><div class="info"><div class="name"><a href="'+Pub.getHtmlUrl("html/goods/cont-4ec8c688d1.html")+"?id="+s.goods[t].goods_id+'">'+s.goods[t].goods_name+'</a></div><div class="brief">来自英国设计师richard c. evans的创意产品，但只要按照凹槽的纹路你就能...</div></div></div><div class="item2">'+s.goods[t].goods_num+'</div><div class="item3">￥'+s.goods[t].goods_price+"</div>");switch(e+='</div></div></li></ul><div class="order-cont"><div class="item"><span>联系人：</span>'+s.user_address.consignee+'</div><div class="item"><span>订单编号：</span>'+s.order_sn+'</div><div class="item"><span>联系电话：</span>'+s.user_address.mobile+'</div><div class="item"><span>下单时间：</span>'+s.add_time+'</div><div class="item"><span>送货地址：</span>'+s.user_address.province+s.user_address.city+s.user_address.district+s.user_address.address+'</div><div class="item"><span>状态：</span>',s.order_status){case"100":e+="待付款";break;case"200":e+="待发货";break;case"101":e+="已取消";break;case"210":e+="待收货";break;case"220":e+="待评价";break;case"222":e+="交易完成"}e+="</div></div></div></div>",setTimeout(function(){a("#order").html(e)},500)},initEvent:function(){var e=this;a("#to_user_address").on("click",function(){var a=Pub.getHtmlUrl("html/user/user-address-20c3d78101.html");s.location.href=a}),a("#to_user_info").on("click",function(){var a=Pub.getHtmlUrl("html/user/user-info-4973f2b554.html");s.location.href=a}),a("#to_user_safe").on("click",function(){var a=Pub.getHtmlUrl("html/user/user-safe-b5e814da06.html");s.location.href=a}),a("#order_all").on("click",function(){a("#order").html(e.params.orderTemp),a(this).siblings().removeClass("active"),a(this).addClass("active"),e.params.offset=0,e.params.orderStatus=0,e.getDataInit()}),a("#order_daifukuan").on("click",function(){a("#order").html(e.params.orderTemp),a(this).siblings().removeClass("active"),a(this).addClass("active"),e.params.offset=0,e.params.orderStatus=100,e.getDataInit()})}};new i}(jQuery,window,document);