!function(a,s,e,t){var i=function(){this.init()};i.prototype={params:{consignee:"",phone:"",mobile:"",post:"",province:"",city:"",district:"",addressNum:0,addressMost:0,balanceUrl:""},init:function(){this.initParams(),this.formCheck(),this.getData(),this.initEvent()},initParams:function(){this.params.addressMost=10,this.params.balanceUrl=Pub.getSession("balanceUrl")},formCheck:function(){a("#add_address_form").Validform({tiptype:function(a,s,e){if(!s.obj.is("form")){var t=s.obj.parents(".box-check").find(".Validform-info").children(".Validform_checktip");e(t,s.type),t.text(a);var i=s.obj.parents(".box-check").find(".Validform-info");if(2==s.type)i.hide();else{if(i.is(":visible"))return;s.obj.offset().left,s.obj.offset().top;i.css({left:"600px",top:"15px"}).show().animate({left:"362px"},200)}}},datatype:{phone:/^(\d{3,4}-)?\d{7,8}$/}})},getData:function(){var a=this;Pub.post("/Home/userAddress/index",{},function(s){if(0===parseInt(s.error_code)){console.log(s);var e=s.data.user_address;a.addressList(e),a.addressCallback()}})},addressList:function(s){var e=this;if(s&&s.length>0){var t="";for(var i in s)s.hasOwnProperty(i)&&(t+='<li data-id="'+s[i].id+'"><div class="item1">'+s[i].consignee+'</div><div class="item2">'+s[i].province+s[i].city+s[i].district+'</div><div class="item3">'+s[i].address+'</div><div class="item4">'+s[i].zipcode+'</div><div class="item5">'+s[i].mobile+'</div><div class="item6"><div class="item6-handle"><a class="active edit" data-id="'+s[i].id+'">修改</a><span>|</span><a class="delect" data-id="'+s[i].id+'">删除</a>',t+=null===e.params.balanceUrl?"":'<span>|</span><a class="active choose" data-id="'+s[i].id+'">选择</a>',t+="</div>",t+=1==s[i].is_default?'<a class="item6-auto">默认地址</a>':'<button class="item6-set set-default" data-id="'+s[i].id+'">设为默认地址</button>',t+="</div></li>");a("#address_list").html(t);var d=e.params.addressMost-s.length;a("#num").text(s.length),a("#remain").text(d)}},addressCallback:function(){var e=this;a(".set-default").on("click",function(){e.params.editId=a(this).attr("data-id");Pub.post("/Home/UserAddress/setDefault",{id:e.params.editId},function(a){0===parseInt(a.error_code)&&(1===a.data.status?(cloud.explain("成功设为默认！","success",2e3),e.getData()):cloud.explain("操作失败！",2e3))})}),a(".edit").on("click",function(){e.params.editId=a(this).attr("data-id"),a("#btn_save").hide(),a("#btn_edit").show(),Pub.post("/Home/UserAddress/detail",{id:e.params.editId},function(s){0===parseInt(s.error_code)&&(a("#consignee").val(s.data.consignee),a("#phone").val(s.data.phone),a("#mobile").val(s.data.mobile),a("#post").val(s.data.post),a("#city").citySelect({prov:s.data.province,city:s.data.city,dist:s.data.district,nodata:"none"}),a("#address").val(s.data.address))})}),a(".delect").on("click",function(){e.params.editId=a(this).attr("data-id"),cloud.asked("确定要删除吗？",function(){Pub.post("/Home/UserAddress/delete",{id:e.params.editId},function(a){0===parseInt(a.error_code)&&(1===a.data.status?(cloud.explain("恭喜您，删除成功！","success",2e3),e.getData()):0===a.data.status&&cloud.explain("删除失败，请重新操作","",2e3))})},function(){cloud.msg("您选择了‘取消’","50%",2e3)})}),a(".choose").on("click",function(){var t=a(this).attr("data-id"),i=e.params.balanceUrl;Pub.setSession("addressId",t),s.location.href=i,Pub.delSession("balanceUrl")})},addAddress:function(){var s=this;s.params.consignee=a("#consignee").val(),s.params.address=a("#address").val(),s.params.mobile=a("#mobile").val(),s.params.phone=a("#phone").val(),s.params.post=a("#post").val(),""===s.params.consignee||""===s.params.address||""===s.params.mobile?cloud.explain("请填写完整信息,再提交！","",2e3):Pub.post("/Home/UserAddress/add",{consignee:s.params.consignee,province:s.params.province,city:s.params.city,district:s.params.district,address:s.params.address,mobile:s.params.mobile,phone:s.params.phone,post:s.params.post},function(e){console.log(e),0===parseInt(e.error_code)&&(cloud.explain("恭喜您，添加成功！","success",2e3),s.params.addressId=e.data.id,s.getData(),a("input:text").val(""))})},editAddress:function(){var s=this;s.params.consignee=a("#consignee").val(),s.params.address=a("#address").val(),s.params.mobile=a("#mobile").val(),s.params.phone=a("#phone").val(),s.params.post=a("#post").val(),s.params.province=a(".prov").val(),s.params.city=a(".city").val(),s.params.district=a(".dist").val(),""===s.params.consignee||""===s.params.address||""===s.params.mobile?cloud.explain("请填写完整信息,再提交！","",2e3):Pub.post("/Home/UserAddress/update",{id:s.params.editId,consignee:s.params.consignee,province:s.params.province,city:s.params.city,district:s.params.district,address:s.params.address,mobile:s.params.mobile,phone:s.params.phone,post:s.params.post},function(e){console.log(e),0===parseInt(e.error_code)&&(1===e.data.status?(cloud.explain("恭喜您，编辑成功！","success",2e3),s.params.addressId=s.params.editId,s.getData(),a("input:text").val(""),a("#btn_edit").hide(),a("#btn_save").show()):cloud.explain("编辑失败，请修改内容再提交！","",2e3))})},initEvent:function(){var e=this;a("#city").citySelect({prov:"-省-",city:"-市-",dist:"-区-",nodata:"none",required:!1}),a("#phone").on("blur",function(){""===a(this).val()&&(a(".Validform-info").hide(),a(this).removeClass("Validform_error"))}),a("#post").on("blur",function(){""===a(this).val()&&(a(".Validform-info").hide(),a(this).removeClass("Validform_error"))}),a(".prov").on("change",function(){e.params.province=a(this).val()}),a(".city").on("change",function(){e.params.city=a(this).val()}),a(".dist").on("change",function(){e.params.district=a(this).val()}),a("#btn_save").on("click",function(){return e.addAddress(),!1}),a("#btn_edit").on("click",function(){return e.editAddress(),!1}),a("#to_user_order").on("click",function(){var a=Pub.getHtmlUrl("html/user/user-order-f393c08e1f.html");s.location.href=a}),a("#to_user_info").on("click",function(){var a=Pub.getHtmlUrl("html/user/user-info-4973f2b554.html");s.location.href=a}),a("#to_user_safe").on("click",function(){var a=Pub.getHtmlUrl("html/user/user-safe-b5e814da06.html");s.location.href=a})}};new i}(jQuery,window,document);