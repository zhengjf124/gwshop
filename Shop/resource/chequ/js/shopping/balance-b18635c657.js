!function(a,s,e,d){var t=function(){this.init()};t.prototype={params:{cartId:[],addressId:0,consignee:"",province:"",city:"",district:"",address:"",mobile:"",phone:"",post:"",editId:0,total:0,invPayee:1,postscript:""},init:function(){this.initParams(),this.hasAddress(),this.formCheck(),this.getData(),this.initEvent()},initParams:function(){var a=Pub.searchToObject().cartId,s=JSON.parse(Pub.getSession("cartId"));a?this.params.cartId.push(a):this.params.cartId=s,this.params.addressId=Pub.getSession("addressId"),this.params.invPayee=1},getData:function(){var a=this;Pub.post("/Home/order/confirm",{cart_id:a.params.cartId},function(s){0===parseInt(s.error_code)&&(a.goodsList(s.data.goods),a.addressData(s.data.address),a.dataEvent())})},goodsList:function(s){if(s&&s.length>0){var e="";a("#goods_list").empty();for(var d in s)if(s.hasOwnProperty(d)){e+='<div class="item"><div class="item1"><div class="img"><a href="'+Pub.getHtmlUrl("html/goods/cont-4ec8c688d1.html")+"?id="+s[d].goods_id+'"><img src="'+s[d].goods_img+'" class="img-scale"></a></div><div class="info"><div class="name"><a href="'+Pub.getHtmlUrl("html/goods/cont-4ec8c688d1.html")+"?id="+s[d].goods_id+'">'+s[d].goods_name+'</a></div><div class="brief">来自英国设计师richard c. evans的创意产品，但只要按照凹槽的纹路你就能...</div></div><div class="spec">';var t=s[d].spec_key_name.split(" ");for(var i in t)t.hasOwnProperty(i)&&(e+="<p><strong>"+t[i]+"</strong></p>");e+='</div></div><div class="item2">'+s[d].goods_price+'</div><div class="item3">'+s[d].goods_num+'</div><div class="item4">'+(s[d].goods_price*s[d].goods_num).toFixed(2)+"</div></div>"}a("#goods_list").append(e)}},addressData:function(s){var e=this;if(e.params.addressId)e.getAddress(),e.addressCallback();else if(null===e.params.addressId&&null!==s){a("#ads").empty();var d='<label class="active"><img src="../../images/icon_check-a4826ed315.png" class="img1"><img src="../../images/icon_check_ed-0e5cbbea5f.png" class="img2"><span>'+s.consignee+"</span><span>"+s.mobile+"</span><span>"+s.province+s.city+s.district+s.address+'</span></label><div class="handle"><a class="visited">默认地址</a><a class="active edit" data-id="'+s.id+'">编辑</a><a class="delect" data-id="'+s.id+'">删除</a></div>';a("#ads").append(d),e.params.addressId=s.id,e.addressCallback()}else if(null===e.params.addressId&&null===s){a("#ads").empty();var d='<label><span>还没有收货地址</span></label><div class="handle"><a class="active" id="add_address">添加收货地址</a></div>';a("#ads").append(d)}},getAddress:function(){var s=this;a("#ads").empty(),Pub.post("/Home/UserAddress/detail",{id:s.params.addressId},function(e){if(0===parseInt(e.error_code)){var d='<label class="active"><img src="../../images/icon_check-a4826ed315.png" class="img1"><img src="../../images/icon_check_ed-0e5cbbea5f.png" class="img2"><span>'+e.data.consignee+"</span><span>"+e.data.mobile+"</span><span>"+e.data.province+e.data.city+e.data.district+e.data.address+'</span></label><div class="handle">';d+=1==e.data.is_default?"<a>默认地址</a>":'<a class="set-default" data-id="'+e.data.id+'">设为默认地址</a>',d+='<a class="active edit" data-id="'+e.data.id+'">编辑</a><a class="delect" data-id="'+e.data.id+'">删除</a></div>',a("#ads").append(d),s.addressCallback()}})},formCheck:function(){a("#add_address_form").Validform({tiptype:function(a,s,e){if(!s.obj.is("form")){var d=s.obj.parents(".box-check").find(".Validform-info").children(".Validform_checktip");e(d,s.type),d.text(a);var t=s.obj.parents(".box-check").find(".Validform-info");if(2==s.type)t.hide();else{if(t.is(":visible"))return;s.obj.offset().left,s.obj.offset().top;t.css({left:"600px",top:"15px"}).show().animate({left:"362px"},200)}}},datatype:{phone:/^(\d{3,4}-)?\d{7,8}$/}})},addAddress:function(){var s=this;s.params.consignee=a("#consignee").val(),s.params.address=a("#address").val(),s.params.mobile=a("#mobile").val(),s.params.phone=a("#phone").val(),s.params.post=a("#post").val(),""===s.params.consignee||""===s.params.address||""===s.params.mobile?cloud.explain("请填写完整信息,再提交！","",2e3):Pub.post("/Home/UserAddress/add",{consignee:s.params.consignee,province:s.params.province,city:s.params.city,district:s.params.district,address:s.params.address,mobile:s.params.mobile,phone:s.params.phone,post:s.params.post},function(e){console.log(e),0===parseInt(e.error_code)&&(cloud.explain("恭喜您，添加成功！","success",2e3),s.params.addressId=e.data.id,s.getAddress(),setTimeout(function(){a("#dialog_add").slideUp(),a("#shadow_add").fadeOut(),a("html").css("overflow-y","auto")},2100))})},editAddress:function(){var s=this;s.params.consignee=a("#consignee").val(),s.params.address=a("#address").val(),s.params.mobile=a("#mobile").val(),s.params.phone=a("#phone").val(),s.params.post=a("#post").val(),s.params.province=a(".prov").val(),s.params.city=a(".city").val(),s.params.district=a(".dist").val(),""===s.params.consignee||""===s.params.address||""===s.params.mobile?cloud.explain("请填写完整信息,再提交！","",2e3):Pub.post("/Home/UserAddress/update",{id:s.params.editId,consignee:s.params.consignee,province:s.params.province,city:s.params.city,district:s.params.district,address:s.params.address,mobile:s.params.mobile,phone:s.params.phone,post:s.params.post},function(e){console.log(e),0===parseInt(e.error_code)&&(1===e.data.status?(cloud.explain("恭喜您，编辑成功！","success",2e3),s.params.addressId=s.params.editId,s.getAddress(),setTimeout(function(){a("#dialog_add").slideUp(),a("#shadow_add").fadeOut(),a("html").css("overflow-y","auto")},2100)):cloud.explain("编辑失败，请修改内容再提交！","",2e3))})},addressCallback:function(){var s=this;a(".set-default").on("click",function(){s.params.editId=a(this).attr("data-id");var e=this;Pub.post("/Home/UserAddress/setDefault",{id:s.params.editId},function(s){0===parseInt(s.error_code)&&(console.log(s),1===s.data.status?(cloud.explain("成功设为默认！","success",2e3),a(e).text("默认地址").removeClass("set-default").addClass("visited")):cloud.explain("操作失败！",2e3))})}),a(".edit").on("click",function(){s.params.editId=a(this).attr("data-id"),a("#dialog_add").slideDown(),a("#shadow_add").fadeIn(),a("#btn_save").hide(),a("#btn_edit").show(),a("html").css("overflow-y","hidden"),Pub.post("/Home/UserAddress/detail",{id:s.params.editId},function(s){console.log(s),0===parseInt(s.error_code)&&(a("#consignee").val(s.data.consignee),a("#phone").val(s.data.phone),a("#mobile").val(s.data.mobile),a("#post").val(s.data.post),a("#city").citySelect({prov:s.data.province,city:s.data.city,dist:s.data.district,nodata:"none"}),a("#address").val(s.data.address))})}),a(".delect").on("click",function(){s.params.editId=a(this).attr("data-id"),cloud.asked("确定要删除吗？",function(){Pub.post("/Home/UserAddress/delete",{id:s.params.editId},function(a){0===parseInt(a.error_code)&&(1===a.data.status?(cloud.explain("恭喜您，删除成功！","success",2e3),s.getData()):0===a.data.status&&cloud.explain("删除失败，请重新操作","",2e3))})},function(){cloud.msg("您选择了‘取消’","50%",2e3)})})},dataEvent:function(){var s=this;a("#add_address").on("click",function(){a("#shadow_add").fadeIn(),a("#dialog_add").slideDown(),a("#btn_save").show(),a("#btn_edit").hide(),a("html").css("overflow-y","hidden")}),a(".item4").each(function(){s.params.total+=parseInt(a(this).text())}),a("#total_price").text(s.params.total.toFixed(2)),a("#btn_edit").on("click",function(){return s.editAddress(),!1})},hasAddress:function(){Pub.post("/Home/userAddress/index",{},function(e){if(0===parseInt(e.error_code)&&e.data.user_address.length>1){var d='<button class="btn-primary" id="btn_choose_address">选择收货地址</button>';a("#btn_check").append(d),a("#btn_choose_address").on("click",function(){console.log(222);var a=Pub.getHtmlUrl("html/user/user-address-20c3d78101.html#address_list"),e=s.location.href;Pub.setSession("balanceUrl",e),s.location.href=a})}})},postData:function(){var s=this;s.params.postscript=a("#txt_message").val(),null===s.params.addressId?cloud.explain("请填写收货地址！","",2e3):Pub.post("/Home/order/add",{address_id:s.params.addressId,cart_id:s.params.cartId,inv_payee:s.params.invPayee,postscript:s.params.postscript},function(a){0===parseInt(a.error_code)&&cloud.explain("提交订单成功！","success",2e3)})},initEvent:function(){var e=this;a("#to_index").on("click",function(){var a=Pub.getHtmlUrl("html/index.html");s.location.href=a}),a("#btn_cancel").on("click",function(){a("#dialog_add").slideUp(),a("#shadow_add").fadeOut(),a("html").css("overflow-y","auto")}),a("#city").citySelect({prov:"-省-",city:"-市-",dist:"-区-",nodata:"none",required:!1}),a("#phone").on("blur",function(){""===a(this).val()&&(a(".Validform-info").hide(),a(this).removeClass("Validform_error"))}),a("#post").on("blur",function(){""===a(this).val()&&(a(".Validform-info").hide(),a(this).removeClass("Validform_error"))}),a(".prov").on("change",function(){e.params.province=a(this).val()}),a(".city").on("change",function(){e.params.city=a(this).val()}),a(".dist").on("change",function(){e.params.district=a(this).val()}),a("#btn_save").on("click",function(){return e.addAddress(),!1}),a("#btn_balance").on("click",function(){e.postData()})}};new t}(jQuery,window,document);