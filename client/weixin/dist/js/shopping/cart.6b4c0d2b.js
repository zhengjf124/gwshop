!function(t,i,a,s){var e=function(){this.init()};e.prototype={params:{cart_total:[],cartId_all:[],price_total:0,list_data:{},goodsParams:[]},init:function(){this.getData()},getData:function(){var t=this;Pub.post("/Home/Cart/index",{},function(i){0===i.error_code&&(t.params.list_data=i.data.list,t.cartList(i.data.list),t.cartIdAll(i.data.list),t.initEvent())})},cartList:function(i){t("#cart_list").empty();var a="";if(i&&i.length>0){for(var s in i){a+='<li><div class="check"><label data-index="'+i[s].id+'"><i>&#xe619;</i></label></div><div class="img"><a href="'+Pub.getHtmlUrl("html/goods/cont.fb80c266.html")+"?id="+i[s].goods_id+'"><span></span><img src="'+i[s].goods_img+'"></a></div><div class="info"><a class="edit" data-count="'+i[s].store_count+'">编辑</a><div class="name"><h3>'+i[s].goods_name+'</h3></div><div class="sizes">';var e=i[s].spec_key_name.split(" ");for(var n in e)a+="<p>"+e[n]+"</p>";a+='</div><div class="price"><span>￥ <font>'+i[s].goods_price+"</font><del>￥"+i[s].market_price+"</del></span><em>X <font>"+i[s].goods_num+'</font></em></div><div class="edit-sizes"><span>';for(var n in e)a+="<label>"+e[n]+"</label>";a+='</span><i>&#xe6d8;</i > </div><div class="edit-container"><div class="qty"><button class="num-minus"><i>&minus;</i></button><input type="text" value="'+i[s].goods_num+'" class="num-number" /><button class="num-plus"><i>&#43;</i></button></div><a class="delect" data-index="'+i[s].id+'">删除</a></div></div></li>'}t("#cart_list").append(a)}else t("#cart_list").append(a)},initEvent:function(){var i=this;t(".check label").on("click",function(){var a=t(this).attr("data-index"),s=t(this).parent().siblings(".info").find(".price").find("span").find("font").text(),e=t(this).parent().siblings(".info").find(".price").find("em").find("font").text(),n=(s*e).toFixed(2);if(t(this).is(".active")){t(this).removeClass("active"),t(".check-total label").removeClass("active");var a=t(this).attr("data-index");i.params.cartId_all=Pub.deleteByValue(i.params.cartId_all,a),i.params.price_total-=parseFloat(n),t("#total_price").text(i.params.price_total.toFixed(2)),i.countNum();var l=t("#cart_list li");t("#count_num").text()!=l.length&&(t(".check-total label").removeClass("active"),t("#del_all").css("visibility","hidden"))}else{t(this).addClass("active"),i.params.cartId_all.push(a),i.params.price_total+=parseFloat(n),t("#total_price").text(i.params.price_total.toFixed(2)),i.countNum();var l=t("#cart_list li");t("#count_num").text()==l.length&&(t(".check-total label").addClass("active"),t("#del_all").css("visibility","visible"))}}),t(".check-total label").on("click",function(){t(this).is(".active")?(t(this).removeClass("active"),t(".check label").removeClass("active"),i.params.cartId_all=[],t("#total_price").text("0"),i.countNum(),t("#del_all").css("visibility","hidden")):(t(this).addClass("active"),t(".check label").addClass("active"),i.params.cartId_all=i.params.cart_total,i.priceTotal(i.params.list_data),t("#total_price").text(i.params.price_total.toFixed(2)),i.countNum(),t("#del_all").css("visibility","visible"))}),t("#submit_balance").on("click",function(){t("#count_num").text()>0&&"编辑全部"===t(".cart-edit").text()?i.postData():0==t("#count_num").text()?cloud.explain("请您先选择商品，再结算！",3e3):"完成"==t(".cart-edit").text()&&cloud.explain("请您编辑完成后，再结算！",3e3)}),t(".num-minus").on("click",function(){var i=t(this).siblings("input"),a=parseInt(i.val());a>1?(i.val(--a),t(this).removeClass("disabled")):t(this).addClass("disabled")}),t(".num-plus").on("click",function(){var i=t(this).siblings("input"),a=parseInt(i.val());i.val(++a)}),t(".edit").on("click",function(){var i=t(this).siblings(".edit-container").find(".qty").find(".num-number").val(),a=t(this).attr("data-count"),s=t(this).parent().siblings(".check").find("label").attr("data-index");"编辑"===t(this).text()?(t(this).text("完成"),t(this).siblings(".sizes").hide(),t(this).siblings(".price").hide(),t(this).siblings(".edit-sizes").show(),t(this).siblings(".edit-container").show(),t(this).attr("data-boolean","true")):(t(this).text("编辑"),t(this).siblings(".sizes").show(),t(this).siblings(".price").show(),t(this).siblings(".edit-sizes").hide(),t(this).siblings(".edit-container").hide(),t(this).attr("data-boolean","false"),i<=parseInt(a)?i=i:i>parseInt(a)&&(i=a),t(this).siblings(".price").find("em").find("font").text(i),Pub.post("/Home/Cart/editGoods",{goods:[{cart_id:s,goods_num:i}]},function(t){0===t.error_code}))}),t(".cart-edit").on("click",function(){"编辑全部"===t(this).text()?(t(this).text("完成"),t("#cart_list li").find(".edit").hide(),t("#cart_list li").find(".sizes").hide(),t("#cart_list li").find(".price").hide(),t("#cart_list li").find(".edit-sizes").show(),t("#cart_list li").find(".edit-container").show(),t("#del_all").css("visibility","visible")):(t(this).text("编辑全部"),t("#cart_list li").find(".edit").show(),t("#cart_list li").find(".sizes").show(),t("#cart_list li").find(".price").show(),t("#cart_list li").find(".edit-sizes").hide(),t("#cart_list li").find(".edit-container").hide(),t("#del_all").css("visibility","hidden"),t("#cart_list li").each(function(){var a=t(this).find(".check").find("label").attr("data-index"),s=t(this).find("input").val(),e=t(this).find(".info").find(".edit").attr("data-count");s<=parseInt(e)?s=s:s>parseInt(e)&&(s=e),t(this).find(".price").find("font").text(s),i.params.goodsParams.push({cart_id:parseInt(a),goods_num:parseInt(s)})}),Pub.post("/Home/Cart/editGoods",{goods:i.params.goodsParams},function(t){0===t.error_code}))}),t(".delect").on("click",function(){var a=this,s=t(this).attr("data-index");cloud.asked("您确定要删除吗？",function(){i.delectGood(s,function(){t(a).parent().parent().parent().fadeOut()})},function(){cloud.msg("您选择了“取消”！","50%",2e3)})}),t("#del_all").on("click",function(){cloud.asked("您确定要删除吗？",function(){i.delectGood(i.params.cartId_all,function(){t("#cart_list").fadeOut()})},function(){cloud.msg("您选择了“取消”！","50%",2e3)})})},cartIdAll:function(t){var i=this;if(t&&t.length>0)for(var a=0,s=0;s<t.length;s++)a=t[s].id,i.params.cart_total.push(a)},postData:function(){var t=this;Pub.post("/Home/order/confirm",{cart_id:t.params.cartId_all},function(i){if(0===i.error_code){var a=JSON.stringify(t.params.cartId_all);localStorage.setItem("cartIds",a),location.href=Pub.getHtmlUrl("html/shopping/balance.a20704ba.html")}})},priceTotal:function(t){var i=this;if(i.params.price_total=0,t&&t.length>0)for(var a=0,s=0;s<t.length;s++)a=t[s].goods_price*t[s].goods_num,i.params.price_total+=a},delectGood:function(t,i){Pub.post("/Home/Cart/delete",{id:t},function(t){0===t.error_code&&cloud.explain("删除成功！","success",2e3)}),i()},countNum:function(){var i=0;t(".check label").each(function(){t(this).is(".active")&&++i}),t("#count_num").text(i)}},new e}(jQuery,window,document);